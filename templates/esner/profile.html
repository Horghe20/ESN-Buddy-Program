{% extends 'layout.html' %}
{% block content %}

<div class="container mt-4">
  <!-- Profile Card -->
  <div class="card border-0 shadow-sm mb-4">
    <h2 class="card-title text-center text-primary mb-3">Profile</h2>
    <div class="card-body">
      <div class="row">
        <!-- Info Section -->
        <div class="col-sm-4 mb-3">
          <h4 class="text-muted">Info</h4>
          <p><strong>ID:</strong> {{ g.esner.id }}</p>
          <p><strong>Name:</strong> {{ g.esner.name }}</p>
          <p><strong>Surname:</strong> {{ g.esner.surname }}</p>
          <p><strong>Type:</strong> {{ g.esner.type }}</p>
          <p><strong>Phone:</strong> {{ g.esner.phone_number }}</p>
          <p><strong>Email:</strong> {{ g.esner.email }}</p>
          <p><strong>Status:</strong> {{ 'Active' if g.esner.is_active else 'Disabled' }}</p>
          <p><strong>NÂ° Buddy:</strong> {{ g.esner.buddies | length }}</p>
          <p><strong>Roles:</strong> {% for role in g.esner.roles %} {{ role.role.name }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
        </div>
        <!-- Details Section -->
        <div class="col-sm-4 mb-3">
          <h4 class="text-muted">Details</h4>
          <p><strong>Languages:</strong> {% for language in g.esner.get_languages_spoken() %} {{ language }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
          <p><strong>Interests:</strong> {% for interest in g.esner.get_interests() %} {{ interest }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
          <p><strong>Description:</strong> {{ g.esner.description }}</p>
        </div>
        <!-- Wants Section -->
        <div class="col-sm-4 mb-3">
          <h4 class="text-muted">Wants</h4>
          <p><strong>Max Buddies:</strong> {{ g.esner.max_number_of_buddy }}</p>
          <p><strong>Gender:</strong> {{ g.esner.gender }}</p>
          <p><strong>Nationality:</strong> {% for nation in g.esner.get_nationality() %} {{ nation }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
          <p><strong>Faculty:</strong> {% for faculty in g.esner.get_faculty() %} {{ faculty }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
        </div>
      </div>
      <a href="{{ url_for('esner.update_profile') }}" class="btn btn-outline-primary mt-3">Update Profile</a>
    </div>
  </div>

  <!-- Buddy Card -->
  <div class="card border-0 shadow-sm">
    <h2 class="card-title text-center text-primary mb-3">Buddy</h2>
    <div class="card-body">
      {% if g.esner.buddies | length > 0 %}
      <div class="table-responsive">
        <table class="table border-top table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Gender</th>
              <th>Nationality</th>
            </tr>
          </thead>
          <tbody id="buddies-table">
            {% for buddy in g.esner.buddies %}
            <tr class="clickable-row-buddies" data-id="{{ buddy.id }}">
              <td>{{ buddy.id }}</td>
              <td>{{ buddy.name }}</td>
              <td>{{ buddy.gender }}</td>
              <td>{% for n in buddy.get_nationality() %} {{ n }}{% if not loop.last %}, {% endif %} {% endfor %}</td>
            </tr>
            <tr class="details" id="details-buddies-{{ buddy.id }}" style="display: none;">
              <td colspan="4">
                <p><strong>Surname:</strong> {{ buddy.surname }}</p>
                <p><strong>Languages:</strong> {% for n in buddy.get_languages_spoken() %} {{ n }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
                <p><strong>Faculty:</strong> {% for n in buddy.get_faculty() %} {{ n }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
                <p><strong>Interests:</strong> {% for n in buddy.get_interests() %} {{ n }}{% if not loop.last %}, {% endif %} {% endfor %}</p>
                <p><strong>Description:</strong> {{ buddy.description }}</p>
                <p><strong>Semester:</strong> {{ buddy.semester }}</p>
                <p><strong>Year:</strong> {{ buddy.year }}</p>
                <p><strong>Phone:</strong> {{ buddy.phone_number }}</p>
                <p><strong>Email:</strong> {{ buddy.email }}</p>
                <p><strong>Instagram:</strong> {{ buddy.instagram }}</p>
                <p><strong>Telegram:</strong> {{ buddy.telegram }}</p>
                <p><strong>Esner:</strong> {{ buddy.esn_member_id }}</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-center text-muted">No Buddy Yet ðŸ˜­</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.querySelectorAll(".clickable-row-buddies").forEach(row => {
    row.addEventListener("click", function () {
      const id = this.dataset.id;
      const detailsRow = document.getElementById(`details-buddies-${id}`);

      document.querySelectorAll("#buddies-table .details").forEach(dr => {
        if (dr !== detailsRow) dr.style.display = "none";
      });
      document.querySelectorAll("#buddies-table .clickable-row-buddies").forEach(buddyRow => {
        if (buddyRow !== this) buddyRow.classList.remove("active-row");
      });

      if (detailsRow.style.display === "none") {
        detailsRow.style.display = "table-row";
        this.classList.add("active-row");
      } else {
        detailsRow.style.display = "none";
        this.classList.remove("active-row");
      }
    });
  });
</script>

{% endblock %}